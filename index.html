<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azurlane-damage</title>
  <style>
    :root {
      --bg: #f5f5f5;
      --card: #fff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --button: #2563eb;
      --button-hover: #1e40af;
      --highlight: #16a34a;
    }
    .dark {
      --bg: #111827;
      --card: #1f2937;
      --text: #f9fafb;
      --muted: #9ca3af;
      --border: #374151;
      --button: #3b82f6;
      --button-hover: #60a5fa;
      --highlight: #22c55e;
    }
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: var(--bg); color: var(--text); transition: background 0.3s, color 0.3s; }
    header { background: var(--card); padding: 16px; text-align: right; box-shadow: 0 2px 6px rgba(0,0,0,.05); position: sticky; top:0; z-index:100; }
    h1 { text-align: center; margin: 20px 0; font-size: 2.2em; }
    h2 { font-size: 1.6em; margin: 30px 0 20px; text-align:center; }
    .container { max-width: 960px; margin: 20px auto; background: var(--card); padding: 30px; border-radius: 14px; box-shadow: 0 8px 30px rgba(0,0,0,.06); transition: background 0.3s; }
    label { display: block; margin-bottom: 6px; font-weight: bold; font-size: 1em; }
    input { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 1em; background: var(--card); color: var(--text); transition: background 0.3s, color 0.3s, border 0.3s; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; }
    button.calc-btn { margin-top: 20px; padding: 14px; cursor: pointer; border: 0; border-radius: 10px; background: var(--button); color: #fff; font-size: 1.1em; font-weight: bold; width:100%; transition: background 0.3s; }
    button.calc-btn:hover { background: var(--button-hover); }
    .result { margin-top: 25px; font-size: 1em; font-weight: bold; color: var(--text); background: var(--bg); padding:15px; border-radius:10px; border:1px solid var(--border); transition: background 0.3s, color 0.3s, border 0.3s; }
    .highlight { font-size: 1.3em; color: var(--highlight); }
    .toggle-btn { padding: 8px 14px; border-radius: 8px; background: var(--button); color: #fff; border: none; cursor: pointer; font-size: 0.9em; font-weight: bold; transition: background 0.3s; }
    .toggle-btn:hover { background: var(--button-hover); }
  </style>
</head>
<body>
  <header>
    <button class="toggle-btn" onclick="toggleDarkMode()">切换深色模式</button>
  </header>

  <!-- 模块三 % Stat Bonus -->
  <div class="container">
    <h2>% Stat Bonus</h2>

    <div class="grid">
      <div>
        <label>原始面板 · 基础</label>
        <input type="number" id="percBase0" value="389">
      </div>
      <div>
        <label>原始面板 · 装备</label>
        <input type="number" id="percEquip0" value="0">
      </div>
      <div>
        <label>原始面板 · 技术</label>
        <input type="number" id="percTech0" value="50">
      </div>
      <div>
        <label>原始面板 · 专武</label>
        <input type="number" id="percSpec0" value="0">
      </div>
    </div>

    <div class="grid">
      <div>
        <label>技能作用面板 · 基础</label>
        <input type="number" id="percBase1" value="389">
      </div>
      <div>
        <label>技能作用面板 · 装备</label>
        <input type="number" id="percEquip1" value="0">
      </div>
      <div>
        <label>技能作用面板 · 技术</label>
        <input type="number" id="percTech1" value="50">
      </div>
      <div>
        <label>技能作用面板 · 专武</label>
        <input type="number" id="percSpec1" value="29">
      </div>
      <div>
        <label>技能百分比（例如 1.1 = +10%）</label>
        <input type="number" step="0.01" id="percSkill" value="1.1">
      </div>
      <div>
        <label>原始伤害</label>
        <input type="number" id="percDmg" value="68">
      </div>
    </div>

    <button class="calc-btn" onclick="calcPerc()">计算 % 加成</button>
    <div class="result" id="percResult"></div>
  </div>

  <script>
    function toggleDarkMode(){ document.body.classList.toggle('dark'); }
    function fmt(n){ return (Math.round(n*1e6)/1e6).toString(); }

    function calcPerc(){
      // 基准（原始面板）
      const base0 = parseFloat(document.getElementById('percBase0').value);
      const equip0 = parseFloat(document.getElementById('percEquip0').value);
      const tech0 = parseFloat(document.getElementById('percTech0').value);
      const spec0 = parseFloat(document.getElementById('percSpec0').value);

      // 技能作用面板（用于乘以百分比）
      const base1 = parseFloat(document.getElementById('percBase1').value);
      const equip1 = parseFloat(document.getElementById('percEquip1').value);
      const tech1 = parseFloat(document.getElementById('percTech1').value);
      const spec1 = parseFloat(document.getElementById('percSpec1').value);

      const perc = parseFloat(document.getElementById('percSkill').value); // 1.xx
      const dmg = parseFloat(document.getElementById('percDmg').value);

      const totalBase = base0 + equip0 + tech0 + spec0; // 例如 439
      const totalRaw  = base1 + equip1 + tech1 + spec1; // 例如 468

      const totalWith = totalRaw * perc;                 // 例如 514.8 (468*1.1)
      const rateWith  = 1 + totalWith/100;               // 6.148
      const rateNo    = 1 + totalBase/100;               // 5.39

      const ratio  = rateWith / rateNo;                  // 1.14063...
      const newDmg = dmg * ratio;
      const minDmg = Math.floor(newDmg - 1);
      const maxDmg = Math.floor(newDmg + 4);

      // 额外参考：+1% 与 +10%（与同一原始面板对比）
      const perc1 = 1.01, perc10 = 1.10;
      const total1  = totalRaw * perc1;
      const total10 = totalRaw * perc10;
      const newDmg1  = dmg * ((1 + total1/100)  / rateNo);
      const newDmg10 = dmg * ((1 + total10/100) / rateNo);

      document.getElementById('percResult').innerHTML = `
        <span class="highlight">新伤害: ${Math.floor(newDmg)}</span> (未取整: ${fmt(newDmg)})<br>
        有技能面板: ${fmt(totalWith)} → 倍率 ${fmt(rateWith)}<br>
        原始面板: ${fmt(totalBase)} → 倍率 ${fmt(rateNo)}<br>
        提升比例: ${fmt(ratio)}<br>
        波动范围: ${minDmg} ~ ${maxDmg}<br><br>
        <b>额外参考</b><br>
        +1% 技能 → 新伤害: ${Math.floor(newDmg1)}<br>
        +10% 技能 → 新伤害: ${Math.floor(newDmg10)}
      `;
    }</span><br>`+
        `有技能面板: ${fmt(totalWithSkill)} → 倍率 ${fmt(rateWith)}<br>`+
        `原始面板: ${fmt(total)} → 倍率 ${fmt(rateNo)}<br>`+
        `提升比例: ${fmt(ratio)}<br>`+
        `波动范围: ${minDmg} ~ ${maxDmg}<br><br>`+
        `<b>额外参考</b><br>`+
        `+1% 技能 → 新伤害: ${Math.floor(newDmg1)} (波动 ${Math.floor(newDmg1-1)} ~ ${Math.floor(newDmg1+4)})<br>`+
        `+10% 技能 → 新伤害: ${Math.floor(newDmg10)} (波动 ${Math.floor(newDmg10-1)} ~ ${Math.floor(newDmg10+4)})`;
    }
  </script>
</body>
</html>
