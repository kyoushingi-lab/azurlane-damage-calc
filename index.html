<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azurlane Damage Calculator</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; background: #f3f4f6; color: #111827; }
    header { background: #1f2937; color: #fff; padding: 20px; text-align: center; position: relative; }
    header h1 { margin: 0; font-size: 2em; }
    header p { margin: 6px 0 0; font-size: 0.95em; color: #d1d5db; }
    header button { position: absolute; right: 20px; top: 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; padding: 8px 14px; cursor: pointer; }

    .container { max-width: 960px; margin: 40px auto; background: white; padding: 30px; border-radius: 14px; box-shadow: 0 8px 24px rgba(0,0,0,.08); }
    h2 { font-size: 1.3em; margin-bottom: 18px; border-left: 6px solid #3b82f6; padding-left: 10px; color: #1f2937; }
    .desc { font-size: 0.95em; color: #4b5563; margin-bottom: 20px; line-height: 1.6; }

    .grid2 { display: grid; grid-template-columns: repeat(2, 1fr); column-gap: 28px; row-gap: 20px; }
    @media (max-width: 780px){ .grid2 { grid-template-columns: 1fr; } }
    .field { display: flex; flex-direction: column; align-items: flex-start; }
    label { margin-bottom: 6px; font-weight: 600; font-size: 1em; color: #374151; text-align: left; }
    input { width: 100%; max-width: 220px; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 1.05em; text-align: right; background: #f3f4f6; transition: border 0.2s, box-shadow 0.2s; }
    input:focus { outline: none; border: 1px solid #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.2); }

    .btn { margin-top: 16px; padding: 14px; cursor: pointer; border: 0; border-radius: 12px; background: linear-gradient(90deg,#2563eb,#7c3aed); color: #fff; font-size: 1.05em; font-weight: 700; width:100%; height: 48px; transition: transform 0.2s, box-shadow 0.2s; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
    .btn.gray { background: #9ca3af; }

    .result { margin-top: 20px; font-size: 1em; background: #f9fafb; padding:20px; border-radius:12px; border-left:6px solid #16a34a; line-height:1.6; }
    .highlight { font-size: 1.8em; font-weight: 800; color: #16a34a; display:block; margin-bottom:8px; }
    .warning { font-weight: 800; color: #d97706; display:block; margin-top:10px; }

    .details { display: none; margin-top: 12px; padding: 12px; background: #f3f4f6; border-radius: 8px; font-size: 0.9em; color: #374151; line-height: 1.5; white-space: pre-line; }
    .toggle-btn { background: none; border: none; color: #2563eb; cursor: pointer; margin-top: 10px; font-size: 0.9em; }
    .toggle-btn:hover { text-decoration: underline; }

    footer { margin-top: 40px; padding: 20px; text-align: center; background: #1f2937; color: #9ca3af; font-size: 0.9em; }
  </style>
</head>
<body>
  <header>
    <h1>Azurlane Damage Calculator</h1>
    <p>Azurlane Damage Calculator</p>
    <button onclick="document.body.classList.toggle('dark')">åˆ‡æ¢æ·±è‰²æ¨¡å¼</button>
  </header>

  <div class="container">
    <h2>è¯´æ˜</h2>
    <div class="desc">
      <b>Azurlane Damage Calculator</b><br>
      <b>é¢æ¿å±æ€§</b>ï¼šç‚®å‡»/é›·å‡»/èˆªç©ºï¼ˆé˜µå‹ã€æŠ€èƒ½ç­‰åŠ ç®—ï¼‰ã€‚<br>
      <b>æ­¦å™¨æ•ˆç‡</b>ï¼šè£…å¤‡æ§½æ•°å€¼ã€‚<br>
      <b>å¯¹ç”²æ•ˆç‡</b>ï¼šè½»ç”²/ä¸­ç”²/é‡ç”²è¡¥æ­£ã€‚<br>
      <b>å¢ä¼¤æŠ€èƒ½</b>ï¼šåˆ†ä¸ºåŠ ç®—ç±»ä¸ç‹¬ç«‹ä¹˜ç®—ç±»ã€‚<br>
      <b>ç­‰çº§å‹åˆ¶</b>ï¼šæ¯çº§å·®2%ï¼Œä¸Šé™Â±50%ã€‚<br>
      ä¼¤å®³æœ€ç»ˆå­˜åœ¨ <b>-1 ~ +4</b> çš„æµ®åŠ¨èŒƒå›´ã€‚
    </div>
  </div>

  <!-- Azurlane Damage -->
  <div class="container">
    <h2>Azurlane Damage</h2>
    <div class="grid2">
      <div class="field"><label>é¢æ¿å±æ€§</label><input type="number" id="attr" value="538"></div>
      <div class="field"><label>å±æ€§æ•ˆç‡</label><input type="number" id="attrEff" value="1"></div>
      <div class="field"><label>æ­¦å™¨é¢æ¿ä¼¤å®³</label><input type="number" id="weaponDmg" value="207"></div>
      <div class="field"><label>æ­¦å™¨ç³»æ•°</label><input type="number" id="weaponCoef" value="1.24"></div>
      <div class="field"><label>æ­¦å™¨æ•ˆç‡</label><input type="number" id="weaponEff" value="1.45"></div>
      <div class="field"><label>å¯¹ç”²æ•ˆç‡</label><input type="number" id="armorEff" value="0.55"></div>
      <div class="field"><label>å¢ä¼¤ç±»æŠ€èƒ½</label><input type="number" id="skillAdd" value="1.1"></div>
      <div class="field"><label>ç‹¬ç«‹å¢ä¼¤</label><input type="number" id="skillMul" value="1.0"></div>
      <div class="field"><label>æ•Œäºº debuff</label><input type="number" id="debuff" value="1"></div>
      <div class="field"><label>æˆ‘æ–¹ç­‰çº§</label><input type="number" id="myLv" value="120"></div>
      <div class="field"><label>æ•Œæ–¹ç­‰çº§</label><input type="number" id="enemyLv" value="35"></div>
      <div class="field"><label>å±é™©æµ·åŸŸç­‰çº§</label><input type="number" id="dangerLv" value="0"></div>
    </div>
    <button class="btn" onclick="calc()">è®¡ç®—ä¼¤å®³</button>
    <button class="btn gray" onclick="resetMain()">é‡ç½®</button>
    <div class="result" id="result"></div>
    <button class="toggle-btn" onclick="toggleDetails('mainDetails')">ğŸ“˜ å±•å¼€å…¬å¼è¯¦æƒ…</button>
    <div class="details" id="mainDetails"></div>
  </div>

  <!-- Flat Stat Bonus -->
  <div class="container">
    <h2>Flat Stat Bonus</h2>
    <div class="grid2">
      <div class="field"><label>åŸºç¡€é¢æ¿</label><input type="number" id="flatBase" value="389"></div>
      <div class="field"><label>è£…å¤‡</label><input type="number" id="flatEquip" value="0"></div>
      <div class="field"><label>æŠ€æœ¯</label><input type="number" id="flatTech" value="50"></div>
      <div class="field"><label>ä¸“æ­¦</label><input type="number" id="flatSpec" value="0"></div>
      <div class="field"><label>æŠ€èƒ½åŠ çº¯æ•°å€¼</label><input type="number" id="flatSkill" value="20"></div>
      <div class="field"><label>åŸå§‹ä¼¤å®³</label><input type="number" id="flatDmg" value="94"></div>
    </div>
    <button class="btn" onclick="calcFlat()">è®¡ç®— Flat åŠ æˆ</button>
    <button class="btn gray" onclick="resetFlat()">é‡ç½®</button>
    <div class="result" id="flatResult"></div>
    <button class="toggle-btn" onclick="toggleDetails('flatDetails')">ğŸ“˜ å±•å¼€å…¬å¼è¯¦æƒ…</button>
    <div class="details" id="flatDetails"></div>
  </div>

  <!-- % Stat Bonus -->
  <div class="container">
    <h2>% Stat Bonus</h2>
    <div class="grid2">
      <div class="field"><label>åŸºç¡€é¢æ¿</label><input type="number" id="percBase" value="389"></div>
      <div class="field"><label>è£…å¤‡</label><input type="number" id="percEquip" value="0"></div>
      <div class="field"><label>æŠ€æœ¯</label><input type="number" id="percTech" value="50"></div>
      <div class="field"><label>ä¸“æ­¦</label><input type="number" id="percSpec" value="29"></div>
      <div class="field"><label>æŠ€èƒ½ç™¾åˆ†æ¯” (1.1 = +10%)</label><input type="number" id="percSkill" value="1.1"></div>
      <div class="field"><label>åŸå§‹ä¼¤å®³</label><input type="number" id="percDmg" value="68"></div>
    </div>
    <button class="btn" onclick="calcPerc()">è®¡ç®— % åŠ æˆ</button>
    <button class="btn gray" onclick="resetPerc()">é‡ç½®</button>
    <div class="result" id="percResult"></div>
    <button class="toggle-btn" onclick="toggleDetails('percDetails')">ğŸ“˜ å±•å¼€å…¬å¼è¯¦æƒ…</button>
    <div class="details" id="percDetails"></div>
  </div>

  <footer>
    Azurlane Damage Calculator v1.0 | Made by <a href="https://github.com/yourname" style="color:#9ca3af;">yourname</a>
  </footer>

<script>
  function clamp(v, lo, hi){ return Math.max(lo, Math.min(hi, v)); }
  function round(n){ return Math.round(n); }
  function fmt(n){ return (Math.round(n*1000)/1000).toString(); }

  function toggleDetails(id){
    const el = document.getElementById(id);
    el.style.display = el.style.display === "block" ? "none" : "block";
  }

  function calc(){
    const attr = +document.getElementById('attr').value;
    const attrEff = +document.getElementById('attrEff').value;
    const weaponDmg = +document.getElementById('weaponDmg').value;
    const weaponCoef = +document.getElementById('weaponCoef').value;
    const weaponEff = +document.getElementById('weaponEff').value;
    const armorEff = +document.getElementById('armorEff').value;
    const skillAdd = +document.getElementById('skillAdd').value;
    const skillMul = +document.getElementById('skillMul').value;
    const debuff = +document.getElementById('debuff').value;
    const myLv = +document.getElementById('myLv').value;
    const enemyLv = +document.getElementById('enemyLv').value;
    const dangerLv = +document.getElementById('dangerLv').value;

    let levelCoef = clamp(1 + (myLv - enemyLv + dangerLv) * 0.02, 0.5, 1.5);
    const statBlock = 1 + attr * attrEff / 100;
    const part1 = statBlock * weaponDmg;
    const base = part1 * weaponCoef * weaponEff * armorEff * skillAdd * debuff * levelCoef * skillMul;

    const dmg = round(base);
    const minDmg = round(base - 1);
    const maxDmg = round(base + 4);

    document.getElementById('result').innerHTML = `
      <span class="highlight">æœ€ç»ˆä¼¤å®³: ${dmg}</span>
      æœªå–æ•´: ${fmt(base)}<br>
      <span class="warning">âš¡ æ³¢åŠ¨èŒƒå›´: ${minDmg} ~ ${maxDmg}</span>
    `;

    document.getElementById('mainDetails').innerText =
      `(1 + ${attr}Ã—${attrEff}/100) Ã— ${weaponDmg} Ã— ${weaponCoef} Ã— ${weaponEff} Ã— ${armorEff} Ã— ${skillAdd} Ã— ${debuff} Ã— ${levelCoef}\n`+
      `= ${fmt(base)}\n`+
      `æœ€ç»ˆä¼¤å®³ = ${dmg} (èŒƒå›´ ${minDmg} ~ ${maxDmg})`;
  }

  function calcFlat(){
    const base = +document.getElementById('flatBase').value;
    const equip = +document.getElementById('flatEquip').value;
    const tech = +document.getElementById('flatTech').value;
    const spec = +document.getElementById('flatSpec').value;
    const skill = +document.getElementById('flatSkill').value;
    const dmg0 = +document.getElementById('flatDmg').value;

    const totalNo = base+equip+tech+spec;
    const totalWith = totalNo + skill;
    const rateNo = 1 + totalNo/100;
    const rateWith = 1 + totalWith/100;
    const ratio = rateWith/rateNo;
    const newDmg = dmg0 * ratio;

    const dmg = round(newDmg);
    const minDmg = round(newDmg - 1);
    const maxDmg = round(newDmg + 4);

    document.getElementById('flatResult').innerHTML = `
      <span class="highlight">æ–°ä¼¤å®³: ${dmg}</span>
      æå‡æ¯”ä¾‹: ${fmt(ratio)}<br>
      <span class="warning">âš¡ æ³¢åŠ¨èŒƒå›´: ${minDmg} ~ ${maxDmg}</span>
    `;

    document.getElementById('flatDetails').innerText =
      `æ€»é¢æ¿æ— æŠ€èƒ½ = ${base}+${equip}+${tech}+${spec} = ${totalNo}\n`+
      `æ€»é¢æ¿æœ‰æŠ€èƒ½ = ${totalNo}+${skill} = ${totalWith}\n`+
      `å€ç‡æ— æŠ€èƒ½ = 1 + ${totalNo}/100 = ${fmt(rateNo)}\n`+
      `å€ç‡æœ‰æŠ€èƒ½ = 1 + ${totalWith}/100 = ${fmt(rateWith)}\n`+
      `æå‡æ¯”ä¾‹ = ${fmt(rateWith)} / ${fmt(rateNo)} = ${fmt(ratio)}\n`+
      `æ–°ä¼¤å®³ = ${dmg0} Ã— ${fmt(ratio)} = ${newDmg.toFixed(2)}\n`+
      `èŒƒå›´ = ${minDmg} ~ ${maxDmg}`;
  }

  function calcPerc(){
    const base = +document.getElementById('percBase').value;
    const equip = +document.getElementById('percEquip').value;
    const tech = +document.getElementById('percTech').value;
    const spec = +document.getElementById('percSpec').value;
    const perc = +document.getElementById('percSkill').value;
    const dmg0 = +document.getElementById('percDmg').value;

    const totalNo = base + equip + tech;        // 439
    const totalWithSpec = totalNo + spec;       // 468
    const applied = totalWithSpec * perc;       // 514.8

    const rateNo = 1 + totalNo/100;             // 5.39
    const rateWith = 1 + applied/100;           // 6.148
    const ratio = rateWith / rateNo;            // 1.14063
    const newDmg = dmg0 * ratio;                // 78

    const dmg = Math.round(newDmg);
    const minDmg = Math.round(newDmg - 1);
    const maxDmg = Math.round(newDmg + 4);

    document.getElementById('percResult').innerHTML = `
      <span class="highlight">æ–°ä¼¤å®³: ${dmg}</span>
      æå‡æ¯”ä¾‹: ${ratio.toFixed(6)}<br>
      <span class="warning">âš¡ æ³¢åŠ¨èŒƒå›´: ${minDmg} ~ ${maxDmg}</span>
    `;

    document.getElementById('percDetails').innerText =
      `æ€»é¢æ¿æ— æŠ€èƒ½ = ${base}+${equip}+${tech} = ${totalNo}\n`+
      `åº”ç”¨æŠ€èƒ½åŸºå‡† = ${totalNo}+${spec} = ${totalWithSpec}\n`+
      `åº”ç”¨æŠ€èƒ½ = ${totalWithSpec} Ã— ${perc} = ${applied.toFixed(3)}\n`+
      `å€ç‡æ— æŠ€èƒ½ = 1 + ${totalNo}/100 = ${rateNo.toFixed(2)}\n`+
      `å€ç‡æœ‰æŠ€èƒ½ = 1 + ${applied.toFixed(3)}/100 = ${rateWith.toFixed(3)}\n`+
      `æå‡æ¯”ä¾‹ = ${rateWith.toFixed(3)} Ã· ${rateNo.toFixed(2)} = ${ratio.toFixed(6)}\n`+
      `æ–°ä¼¤å®³ = ${dmg0} Ã— ${ratio.toFixed(6)} = ${newDmg.toFixed(2)}\n`+
      `èŒƒå›´ = ${minDmg} ~ ${maxDmg}`;
  }

  function resetMain(){ ['attr','attrEff','weaponDmg','weaponCoef','weaponEff','armorEff','skillAdd','skillMul','debuff','myLv','enemyLv','dangerLv'].forEach(id=>document.getElementById(id).value=document.getElementById(id).defaultValue); document.getElementById('result').innerHTML=''; document.getElementById('mainDetails').style.display='none'; }
  function resetFlat(){ ['flatBase','flatEquip','flatTech','flatSpec','flatSkill','flatDmg'].forEach(id=>document.getElementById(id).value=document.getElementById(id).defaultValue); document.getElementById('flatResult').innerHTML=''; document.getElementById('flatDetails').style.display='none'; }
  function resetPerc(){ ['percBase','percEquip','percTech','percSpec','percSkill','percDmg'].forEach(id=>document.getElementById(id).value=document.getElementById(id).defaultValue); document.getElementById('percResult').innerHTML=''; document.getElementById('percDetails').style.display='none'; }
</script>

</body>
</html>

