<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azurlane-damage</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    .container { max-width: 880px; margin: auto; background: #fff; padding: 20px; border-radius: 14px; box-shadow: 0 8px 30px rgba(0,0,0,.06); }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select { width: 100%; padding: 8px 10px; margin-top: 6px; border: 1px solid #e5e7eb; border-radius: 8px; }
    .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; }
    button { margin-top: 20px; padding: 10px 16px; cursor: pointer; border: 0; border-radius: 10px; background:#111827; color:#fff; }
    .muted { color:#6b7280; font-size: 12px; }
    .result { margin-top: 18px; font-size: 1.1em; font-weight: bold; color: #111827; }
    details { background:#f9fafb; border:1px solid #e5e7eb; padding:12px; border-radius:10px; margin-top:12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Azurlane-damage</h1>
    <p class="muted">公式：<code>(1 + 面板属性 × 属性效率 ÷ 100) × 武器面板伤害 × 武器系数 × 武器效率 × 对甲效率 × 增伤(加算) × 敌人debuff × 等级压制 × 独立增伤</code></p>

    <div class="grid">
      <div>
        <label>面板属性（炮击/雷击/航空）</label>
        <input type="number" id="attr" value="538">
      </div>
      <div>
        <label>属性效率（倍率，常规=1，航弹=0.8）</label>
        <input type="number" step="0.01" id="attrEff" value="1">
      </div>
      <div>
        <label>武器面板伤害</label>
        <input type="number" id="weaponDmg" value="207">
      </div>
      <div>
        <label>武器系数</label>
        <input type="number" step="0.01" id="weaponCoef" value="1.24">
      </div>
      <div>
        <label>武器效率（槽效率）</label>
        <input type="number" step="0.01" id="weaponEff" value="1.45">
      </div>
      <div>
        <label>对甲效率</label>
        <input type="number" step="0.01" id="armorEff" value="0.55">
      </div>
      <div>
        <label>增伤类技能（加算，合并后填倍率，如 1.1）</label>
        <input type="number" step="0.01" id="skillAdd" value="1.1">
      </div>
      <div>
        <label>独立增伤（乘算，多个相乘后填，例如 1.15×1.12=1.288）</label>
        <input type="number" step="0.001" id="skillMul" value="1.0">
      </div>
      <div>
        <label>敌人 debuff（例如 1.1 表示+10%）</label>
        <input type="number" step="0.01" id="debuff" value="1">
      </div>
      <div>
        <label>我方等级</label>
        <input type="number" id="myLv" value="120">
      </div>
      <div>
        <label>敌方等级</label>
        <input type="number" id="enemyLv" value="35">
      </div>
      <div>
        <label>原始危险海域等级（安全海域填 0）</label>
        <input type="number" id="dangerLv" value="0">
      </div>
    </div>

    <button onclick="calc()">计算伤害</button>

    <div class="result" id="result"></div>

    <details>
      <summary>解释说明</summary>
      <div class="muted">
        <p>面板属性：炮击，雷击，航空（阵型、增加属性的技能，全部加算）</p>
        <p>属性效率：通常为100%，航空炸弹为80%，航空鱼雷为100%，弹幕100%</p>
        <p>武器面板伤害：武器本身标注的伤害。弹幕，航弹，魔法副炮见 <a href="https://wiki.biligame.com/blhx/%E5%85%A8%E6%AD%A6%E5%99%A8%E5%AF%B9%E6%8A%A4%E7%94%B2%E8%A1%A5%E6%AD%A3%E4%B8%80%E8%A7%88" target="_blank">《全武器秒伤和对护甲补正》</a></p>
        <p>武器系数：除舰炮外均为100%。舰炮系数见 <a href="https://wiki.biligame.com/blhx/%E5%85%A8%E6%AD%A6%E5%99%A8%E5%AF%B9%E6%8A%A4%E7%94%B2%E8%A1%A5%E6%AD%A3%E4%B8%80%E8%A7%88" target="_blank">《全武器秒伤和对护甲补正》</a></p>
        <p>武器效率：装备槽上标注的数值。雷巡魔法副炮约为30~40%，其他不可见武器均为100%。</p>
        <p>对甲效率：见《全武器秒伤和对护甲补正》</p>
        <p>增伤技能：<br>1. XX伤害提升X%，包括满弹10%，空弹-50%，加算。<br>2. 特种猎杀，独立增伤。<br>3. 弹药精通，独立增伤。<br>4. 手操伤害提升，独立增伤。</p>
        <p>敌人 debuff：敌人受到的 debuff，相互之间乘算。</p>
        <p>等级压制：每一级2%，上限50%。当危险海域等级为0时，将原始危险海域等级加入等级压制计算，即（己方等级-敌方等级+原始危险海域等级）×2%</p>
        <p>PS：伤害存在波动 -1 ~ +4</p>
      </div>
    </details>

    <details>
      <summary>查看中间步骤</summary>
      <div id="steps" class="muted"></div>
    </details>
  </div>

  <script>
    function clamp(v, lo, hi){ return Math.max(lo, Math.min(hi, v)); }
    function fmt(n){ return (Math.round(n*1e6)/1e6).toString(); }

    function calc(){
      const attr = parseFloat(document.getElementById('attr').value);
      const attrEff = parseFloat(document.getElementById('attrEff').value);
      const weaponDmg = parseFloat(document.getElementById('weaponDmg').value);
      const weaponCoef = parseFloat(document.getElementById('weaponCoef').value);
      const weaponEff = parseFloat(document.getElementById('weaponEff').value);
      const armorEff = parseFloat(document.getElementById('armorEff').value);
      const skillAdd = parseFloat(document.getElementById('skillAdd').value);
      const skillMul = parseFloat(document.getElementById('skillMul').value);
      const debuff = parseFloat(document.getElementById('debuff').value);
      const myLv = parseFloat(document.getElementById('myLv').value);
      const enemyLv = parseFloat(document.getElementById('enemyLv').value);
      const dangerLv = parseFloat(document.getElementById('dangerLv').value);

      let levelCoef = clamp(1 + (myLv - enemyLv + dangerLv) * 0.02, 0.5, 1.5);

      const statBlock = 1 + attr * attrEff / 100;
      const part1 = statBlock * weaponDmg;

      const base = part1 * weaponCoef * weaponEff * armorEff * skillAdd * debuff * levelCoef * skillMul;

      const minDmg = Math.floor(base - 1);
      const maxDmg = Math.floor(base + 4);

      document.getElementById('result').innerHTML = `最终伤害(未向下取整): ${fmt(base)}<br>最终伤害(向下取整): ${Math.floor(base)}<br>伤害波动范围: ${minDmg} ~ ${maxDmg}`;

      document.getElementById('steps').innerHTML = `
        (1 + 面板属性 × 属性效率 ÷ 100) = (1 + ${attr} × ${attrEff} ÷ 100) = <b>${fmt(statBlock)}</b><br>
        与武器面板相乘： ${fmt(statBlock)} × ${weaponDmg} = <b>${fmt(part1)}</b><br>
        乘区： × 武器系数 ${weaponCoef} × 武器效率 ${weaponEff} × 对甲 ${armorEff} × 加算 ${skillAdd} × debuff ${debuff} × 等级压制 ${fmt(levelCoef)} × 独立增伤 ${skillMul}<br>
        = <b>${fmt(base)}</b>
      `;
    }

    calc();
  </script>
</body>
</html>
