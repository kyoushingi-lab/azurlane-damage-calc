<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azurlane-damage</title>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    :root {
      --bg: #f5f5f5;
      --card: #fff;
      --text: #111827;
      --muted: #6b7280;
      --border: #e5e7eb;
      --button: #2563eb;
      --button-hover: #1e40af;
      --highlight: #16a34a;
    }
    .dark {
      --bg: #111827;
      --card: #1f2937;
      --text: #f9fafb;
      --muted: #9ca3af;
      --border: #374151;
      --button: #3b82f6;
      --button-hover: #60a5fa;
      --highlight: #22c55e;
    }
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: var(--bg); color: var(--text); transition: background 0.3s, color 0.3s; }
    header { background: var(--card); padding: 16px; text-align: right; box-shadow: 0 2px 6px rgba(0,0,0,.05); position: sticky; top:0; z-index:100; }
    h1 { text-align: center; margin: 20px 0; font-size: 2.2em; }
    h2 { font-size: 1.6em; margin: 30px 0 20px; text-align:center; }
    .container { max-width: 960px; margin: 20px auto; background: var(--card); padding: 30px; border-radius: 14px; box-shadow: 0 8px 30px rgba(0,0,0,.06); transition: background 0.3s; }
    label { display: block; margin-bottom: 6px; font-weight: bold; font-size: 1em; }
    input, select { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 1em; background: var(--card); color: var(--text); transition: background 0.3s, color 0.3s, border 0.3s; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; }
    button.calc-btn { margin-top: 20px; padding: 14px; cursor: pointer; border: 0; border-radius: 10px; background: var(--button); color: #fff; font-size: 1.1em; font-weight: bold; width:100%; transition: background 0.3s; }
    button.calc-btn:hover { background: var(--button-hover); }
    .muted { color: var(--muted); font-size: 0.9em; }
    .result { margin-top: 25px; font-size: 1em; font-weight: bold; color: var(--text); background: var(--bg); padding:15px; border-radius:10px; border:1px solid var(--border); transition: background 0.3s, color 0.3s, border 0.3s; }
    .highlight { font-size: 1.3em; color: var(--highlight); }
    details { background: var(--bg); border:1px solid var(--border); padding:14px; border-radius:10px; margin-top:18px; font-size: 0.95em; transition: background 0.3s, border 0.3s; }
    summary { cursor:pointer; font-weight:bold; }
    .toggle-btn { padding: 8px 14px; border-radius: 8px; background: var(--button); color: #fff; border: none; cursor: pointer; font-size: 0.9em; font-weight: bold; transition: background 0.3s; }
    .toggle-btn:hover { background: var(--button-hover); }
  </style>
</head>
<body>
  <header>
    <button class="toggle-btn" onclick="toggleDarkMode()">切换深色模式</button>
  </header>

  <!-- 模块一 Azurlane-damage -->
  <div class="container">
    <h1>Azurlane-damage</h1>
    <p class="muted" style="text-align:center; margin-bottom:30px;">公式：<code>(1 + 面板属性 × 属性效率 ÷ 100) × 武器面板伤害 × 武器系数 × 武器效率 × 对甲效率 × 增伤(加算) × 敌人debuff × 等级压制 × 独立增伤</code></p>

    <div class="grid">
      <div>
        <label>面板属性（炮击/雷击/航空）</label>
        <input type="number" id="attr" value="538">
      </div>
      <div>
        <label>属性效率（倍率，常规=1，航弹=0.8）</label>
        <input type="number" step="0.01" id="attrEff" value="1">
      </div>
      <div>
        <label>武器面板伤害</label>
        <input type="number" id="weaponDmg" value="207">
      </div>
      <div>
        <label>武器系数</label>
        <input type="number" step="0.01" id="weaponCoef" value="1.24">
      </div>
      <div>
        <label>武器效率（槽效率）</label>
        <input type="number" step="0.01" id="weaponEff" value="1.45">
      </div>
      <div>
        <label>对甲效率</label>
        <input type="number" step="0.01" id="armorEff" value="0.55">
      </div>
      <div>
        <label>增伤类技能（加算，合并后填倍率，如 1.1）</label>
        <input type="number" step="0.01" id="skillAdd" value="1.1">
      </div>
      <div>
        <label>独立增伤（乘算，多个相乘后填，例如 1.15×1.12=1.288）</label>
        <input type="number" step="0.001" id="skillMul" value="1.0">
      </div>
      <div>
        <label>敌人 debuff（例如 1.1 表示+10%）</label>
        <input type="number" step="0.01" id="debuff" value="1">
      </div>
      <div>
        <label>我方等级</label>
        <input type="number" id="myLv" value="120">
      </div>
      <div>
        <label>敌方等级</label>
        <input type="number" id="enemyLv" value="35">
      </div>
      <div>
        <label>原始危险海域等级（安全海域填 0）</label>
        <input type="number" id="dangerLv" value="0">
      </div>
    </div>

    <button class="calc-btn" onclick="calc()">计算伤害</button>
    <div class="result" id="result"></div>
  </div>

  <!-- 模块二 Flat Stat Bonus -->
  <div class="container">
    <h2>Flat Stat Bonus</h2>
    <div class="grid">
      <div>
        <label>基础面板</label>
        <input type="number" id="flatBase" value="389">
      </div>
      <div>
        <label>装备</label>
        <input type="number" id="flatEquip" value="0">
      </div>
      <div>
        <label>技术</label>
        <input type="number" id="flatTech" value="50">
      </div>
      <div>
        <label>专武</label>
        <input type="number" id="flatSpec" value="0">
      </div>
      <div>
        <label>技能加纯数值</label>
        <input type="number" id="flatSkill" value="20">
      </div>
      <div>
        <label>原始伤害</label>
        <input type="number" id="flatDmg" value="94">
      </div>
    </div>
    <button class="calc-btn" onclick="calcFlat()">计算 Flat 加成</button>
    <div class="result" id="flatResult"></div>
  </div>

  <!-- 模块三 % Stat Bonus -->
  <div class="container">
    <h2>% Stat Bonus</h2>
    <div class="grid">
      <div>
        <label>基础面板</label>
        <input type="number" id="percBase" value="389">
      </div>
      <div>
        <label>装备</label>
        <input type="number" id="percEquip" value="0">
      </div>
      <div>
        <label>技术</label>
        <input type="number" id="percTech" value="50">
      </div>
      <div>
        <label>专武</label>
        <input type="number" id="percSpec" value="29">
      </div>
      <div>
        <label>技能百分比（例如 1.1 = +10%）</label>
        <input type="number" step="0.01" id="percSkill" value="1.1">
      </div>
      <div>
        <label>原始伤害</label>
        <input type="number" id="percDmg" value="68">
      </div>
    </div>
    <button class="calc-btn" onclick="calcPerc()">计算 % 加成</button>
    <div class="result" id="percResult"></div>
  </div>

  <script>
    function toggleDarkMode(){ document.body.classList.toggle('dark'); }
    function clamp(v, lo, hi){ return Math.max(lo, Math.min(hi, v)); }
    function fmt(n){ return (Math.round(n*1e6)/1e6).toString(); }

    // 模块一
    function calc(){
      const attr = parseFloat(document.getElementById('attr').value);
      const attrEff = parseFloat(document.getElementById('attrEff').value);
      const weaponDmg = parseFloat(document.getElementById('weaponDmg').value);
      const weaponCoef = parseFloat(document.getElementById('weaponCoef').value);
      const weaponEff = parseFloat(document.getElementById('weaponEff').value);
      const armorEff = parseFloat(document.getElementById('armorEff').value);
      const skillAdd = parseFloat(document.getElementById('skillAdd').value);
      const skillMul = parseFloat(document.getElementById('skillMul').value);
      const debuff = parseFloat(document.getElementById('debuff').value);
      const myLv = parseFloat(document.getElementById('myLv').value);
      const enemyLv = parseFloat(document.getElementById('enemyLv').value);
      const dangerLv = parseFloat(document.getElementById('dangerLv').value);
      let levelCoef = clamp(1 + (myLv - enemyLv + dangerLv) * 0.02, 0.5, 1.5);
      const statBlock = 1 + attr * attrEff / 100;
      const part1 = statBlock * weaponDmg;
      const base = part1 * weaponCoef * weaponEff * armorEff * skillAdd * debuff * levelCoef * skillMul;
      const minDmg = Math.floor(base - 1);
      const maxDmg = Math.floor(base + 4);
      document.getElementById('result').innerHTML = `<span class="highlight">最终伤害: ${Math.floor(base)}</span><br>(未取整: ${fmt(base)})<br>波动范围: ${minDmg} ~ ${maxDmg}`;
    }

    // 模块二 Flat Stat Bonus
    function calcFlat(){
      const base = parseFloat(document.getElementById('flatBase').value);
      const equip = parseFloat(document.getElementById('flatEquip').value);
      const tech = parseFloat(document.getElementById('flatTech').value);
      const spec = parseFloat(document.getElementById('flatSpec').value);
      const skill = parseFloat(document.getElementById('flatSkill').value);
      const dmg = parseFloat(document.getElementById('flatDmg').value);
      const totalWithSkill = base+equip+tech+spec+skill;
      const totalNoSkill = base+equip+tech+spec;
      const rateWith = 1 + totalWithSkill/100;
      const rateNo = 1 + totalNoSkill/100;
      const ratio = rateWith/rateNo;
      const newDmg = dmg * ratio;
      const minDmg = Math.floor(newDmg - 1);
      const maxDmg = Math.floor(newDmg + 4);
      document.getElementById('flatResult').innerHTML = `<span class="highlight">新伤害: ${fmt(newDmg)}</span><br>`+
      `总值(有技能): ${totalWithSkill} → ${fmt(rateWith)}<br>`+
      `原始总值: ${totalNoSkill} → ${fmt(rateNo)}<br>`+
      `提升比例: ${fmt(ratio)}<br>`+
      `波动范围: ${minDmg} ~ ${maxDmg}`;
    }

    // 模块三 % Stat Bonus
    function calcPerc(){
      const base = parseFloat(document.getElementById('percBase').value);
      const equip = parseFloat(document.getElementById('percEquip').value);
      const tech = parseFloat(document.getElementById('percTech').value);
      const spec = parseFloat(document.getElementById('percSpec').value);
      const perc = parseFloat(document.getElementById('percSkill').value);
      const dmg = parseFloat(document.getElementById('percDmg').value);
      const total = base+equip+tech+spec;
      const totalWithSkill = total * perc;
      const rateWith = 1 + totalWithSkill/100;
      const rateNo = 1 + total/100;
      const ratio = rateWith/rateNo;
      const newDmg = dmg * ratio;
      const minDmg = Math.floor(newDmg - 1);
      const maxDmg = Math.floor(newDmg + 4);

      // 额外计算 1% 和 10%
      const perc1 = 1.01;
      const perc10 = 1.1;
      const newDmg1 = dmg * ((1+(total*perc1)/100)/(1+total/100));
      const newDmg10 = dmg * ((1+(total*perc10)/100)/(1+total/100));

      document.getElementById('percResult').innerHTML = `<span class="highlight">新伤害: ${fmt(newDmg)}</span><br>`+
      `总值(有技能): ${fmt(totalWithSkill)} → ${fmt(rateWith)}<br>`+
      `原始总值: ${total} → ${fmt(rateNo)}<br>`+
      `提升比例: ${fmt(ratio)}<br>`+
      `波动范围: ${minDmg} ~ ${maxDmg}<br><br>`+
      `<b>额外参考</b><br>`+
      `+1% 技能 → 新伤害: ${Math.floor(newDmg1)}<br>`+
      `+10% 技能 → 新伤害: ${Math.floor(newDmg10)}`;
    }
  </script>
</body>
</html>
